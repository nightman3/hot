Электронную почту в Python можно отправлять двумя способами: поднять собственный SMTP-сервер (с помощью модуля smtpd), либо написать скрипт с помощью библиотеки smtplib, являющейся клиентом этого протокола

Во втором случае для отправки нам нужно подключиться к какому-либо SMTP-серверу, например smtp.yandex.ru, поэтому для примера мы возьмем свой электронный ящик на Яндексе, но можно использовать абсолютно любую, даже доменную почту.


Подключаться к серверу мы будем через конструктор класса SMTP  — именно он инкапсулирует SMTP-соединение

Host — указывается IP-адрес или домен SMTP-сервера
Port —  указывается порт подключения. Тут всё зависит от того, используется ли на сервере шифрование. Как правило, порт без шифрования — 25, с TLS — 587, c SSL — 465)
Local_hostname — если SMTP-сервер расположен на локальном ПК, то необходимо указать localhost.
Source_address — необязательный параметр, который позволяет выполнять привязку к определенному исходному адресу на машине с несколькими сетевыми интерфейсами и/или к определенному исходному TCP-порту

Отправка самого сообщения происходит за счет метода SMTP.sendmail

Настройка ящика
Так как мы тестируем отправку через ящик Яндекса, перед тем как начать необходимо проверить настройки — скрипт работает как обычный почтовый клиент.

Первым делом, необходимо проверить, включен ли в ящике IMAP (без него SMTP работать не будет по соображениям безопасности)

Импортируем нужные для работы библиотеки:
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText  для кодировки на русском 

Далее создаём сообщение с помощью класса MIMEMultipart — нужно указать все заголовки (части) составного сообщения. MIMEText предназначен для текста (например, text/plain или text/html), если все сообщение находится в текстовом формате или его часть.

msg = MIMEMultipart()
msg['From'] = '****@yandex.ru'
msg['To'] = '****@gmail.com'
msg['Subject'] = 'Тест скрипта SMTP'
message = 'Это тестовое сообщение и отвечать на него не нужно'
msg.attach(MIMEText(message))

Создаём экземпляр (объект) класса SMTP. Обратите внимание на строчку mailserver.set_debuglevel(True) — так мы включаем режим отладки, чтобы в случае проблем можно было посмотреть логи

mailserver = smtplib.SMTP('smtp.yandex.ru',587)
mailserver.set_debuglevel(True)

Дальше нам нужно инициировать рукопожатие TLS. Отправляем команду ehlo() — сервер должен ответить на него. Затем запускаем сам протокол. После запуска вы должны снова вызвать ehlo() перед аутентификацией.

# Определяем, поддерживает ли сервер TLS
    mailserver.ehlo()
# Защищаем соединение с помощью шифрования tls
    mailserver.starttls()
# Повторно идентифицируем себя как зашифрованное соединение перед аутентификацией.
    mailserver.ehlo()

Подключаемся к серверу, отправляем письмо. Используем as_string (), чтобы превратить MIMEText в строку

mailserver.login('*****@yandex.ru', 'здесь_пароль')
mailserver.sendmail('*****@yandex.ru','****@gmail.com',msg.as_string())

добавили простую обработку исключений (try/except) для удобства вывода


import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText

msg = MIMEMultipart()
msg['From'] = '******@yandex.ru'
msg['To'] = '*****@gmail.com'
msg['Subject'] = 'Тест скрипта SMTP'
message = 'Это тестовое сообщение и отвечать на него не нужно'
msg.attach(MIMEText(message))
try:
    mailserver = smtplib.SMTP('smtp.yandex.ru',587)
    mailserver.set_debuglevel(True)
# Определяем, поддерживает ли сервер TLS
    mailserver.ehlo()
# Защищаем соединение с помощью шифрования tls
    mailserver.starttls()
# Повторно идентифицируем себя как зашифрованное соединение перед аутентификацией.
    mailserver.ehlo()
    mailserver.login('******@yandex.ru', 'здесь_пароль')

    mailserver.sendmail('******@yandex.ru','******@gmail.com',msg.as_string())

    mailserver.quit()   sys.exit() лучше так выходить 
    print("Письмо успешно отправлено")
except smtplib.SMTPException:
    print("Ошибка: Невозможно отправить сообщение")
